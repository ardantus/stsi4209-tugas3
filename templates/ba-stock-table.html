<script type="text/x-template" id="tpl-stock-table">
  <div>
    <h2>Stok Bahan Ajar</h2>

    <!-- Filter & Sort -->
    <div style="margin:20px 0;">
      <select v-model="filterUpbjj" @change="$forceUpdate()">
        <option value="">Semua UT Daerah</option>
        <option v-for="u in upbjjList" :value="u">{{u}}</option>
      </select>

      <select v-model="filterKategori" :disabled="!filterUpbjj">
        <option value="">Semua Kategori</option>
        <option v-for="k in kategoriByUpbjj" :value="k">{{k}}</option>
      </select>

      <label><input type="checkbox" v-model="filterKritis"> Hanya stok kritis</label>

      <button @click="resetFilter">Reset Filter</button>
      <button @click="startAdd" style="float:right;">+ Tambah Baru</button>
    </div>

    <!-- Form Tambah/Edit -->
    <div v-if="showForm" style="background:#f9f9f9; padding:15px; margin-bottom:20px; border:1px solid #ddd;">
      <h3>{{ editIndex>=0 ? 'Edit' : 'Tambah' }} Bahan Ajar</h3>
      <input v-model="form.kode" placeholder="Kode" @keyup.enter="save">
      <input v-model="form.judul" placeholder="Judul" @keyup.enter="save">
      <select v-model="form.kategori"><option v-for="k in kategoriList">{{k}}</option></select>
      <select v-model="form.upbjj"><option v-for="u in upbjjList">{{u}}</option></select>
      <input v-model="form.lokasiRak" placeholder="Lokasi Rak">
      <input type="number" v-model.number="form.harga" placeholder="Harga">
      <input type="number" v-model.number="form.qty" placeholder="Qty">
      <input type="number" v-model.number="form.safety" placeholder="Safety Stock">
      <textarea v-model="form.catatanHTML" placeholder="Catatan HTML"></textarea>
      <button @click="save">Simpan (Enter)</button>
      <button @click="showForm=false">Batal</button>
    </div>

    <!-- Tabel -->
    <table>
      <thead>
        <tr>
          <th @click="sortBy('kode')">Kode</th>
          <th @click="sortBy('judul')">Judul</th>
          <th>Kategori</th>
          <th>UT Daerah</th>
          <th>Lokasi Rak</th>
          <th @click="sortBy('harga')">Harga</th>
          <th @click="sortBy('qty')">Stok')">Stok</th>
          <th>Safety</th>
          <th>Status</th>
          <th>Catatan</th>
          <th>Aksi</th>
        </tr>
      </thead>
      <tbody>
        <tr v-for="(item, i) in filtered" :key="item.kode">
          <td>{{ item.kode }}</td>
          <td>{{ item.judul }}</td>
          <td>{{ item.kategori }}</td>
          <td>{{ item.upbjj }}</td>
          <td>{{ item.lokasiRak }}</td>
          <td>{{ formatRupiah(item.harga) }}</td>
          <td>{{ formatBuah(item.qty) }}</td>
          <td>{{ formatBuah(item.safety) }}</td>
          <td><ba-status-badge :qty="item.qty" :safety="item.safety"></ba-status-badge></td>
          <td>
            <span v-html="item.catatanHTML" @mouseover="app.modal={show:true, title:'Catatan '+item.kode, content:item.catatanHTML}"></span>
          </td>
          <td>
            <button @click="startEdit(item, i)">Edit</button>
            <button @click="hapus(i)" style="color:red;">Hapus</button>
          </td>
        </tr>
      </tbody>
    </table>
  </div>
</script>